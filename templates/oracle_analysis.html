<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Oracle Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 2rem;">
  <h1>ğŸ” Step 2: Upload Screenshot and Charge Your Friend</h1>
  <p style="max-width: 600px; margin: 1rem auto; font-size: 1.1rem;">
    Upload your friend's screenshot here to receive divine analysis.
    Then, generate a payment link to charge them $1 for your wisdom.
  </p>

  <form action="" method="POST" enctype="multipart/form-data">
    <input type="file" name="screenshots" accept="image/*" multiple required />
    <br/><br/>
    <button type="submit" style="padding: 1rem 2rem;">ğŸ“œ Analyze Screenshot</button>
  </form>

  <br/>

  <form action="/generate-payment-link" method="POST">
    <label for="oracle_id">Enter your Oracle ID:</label>
    <input type="text" name="oracle_id" required style="margin: 0.5rem;" />
    <button type="submit" style="padding: 0.5rem 1.2rem;">ğŸ’¸ Generate Payment Link</button>
  </form>

  {% if payment_link %}
    <h3>Your Payment Link</h3>
    <code id="payment-link" style="font-size: 1rem;">{{ payment_link }}</code>
    <br/>
    <button onclick="copyLink()" style="margin-top: 0.5rem;">ğŸ“‹ Copy to Clipboard</button>

    <div style="margin-top: 2rem;">
      <h4>Scan QR Code</h4>
      <canvas id="qrcode"></canvas>
    </div>

    <script>
      function copyLink() {
        const linkText = document.getElementById("payment-link").innerText;
        navigator.clipboard.writeText(linkText).then(() => {
          alert("Link copied to clipboard!");
        });
      }

      const qrLink = document.getElementById("payment-link").innerText;
      QRCode.toCanvas(document.getElementById("qrcode"), qrLink, { width: 200 });
    </script>
  {% endif %}

  {% if analysis %}
    <h2>ğŸ§  GPTâ€™s Oracle Insight</h2>
    <p style="white-space: pre-wrap; margin-top: 1rem;">{{ analysis }}</p>
    <p style="color: gray; font-size: 0.9rem;">Copy this and send it to your friend once theyâ€™ve paid.</p>
  {% endif %}

  {% if extracted_text %}
    <h3>ğŸ“„ Extracted Text from Screenshot</h3>
    <p style="white-space: pre-wrap; color: gray;">{{ extracted_text }}</p>
  {% endif %}

  <p style="margin-top: 2rem;">
    <a href="/" style="font-size: 1rem;">â¬…ï¸ Back to Homepage</a>
  </p>
</body>
</html>
